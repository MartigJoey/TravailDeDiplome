# LogBook
| Auteur | Date de début | Projet  | Description | Communication |
| ------------- |:-------------:| :-----|---|---|
| Joey Martig| 19.04.2021 | Travail de diplome Covid propagation | Applications permettant de voir l'évolution d'un virus dans un environnement peuplé d'individus. | Joey.mrtg@eduge.ch Joey.mrtg@gmail.com |

# 19.04.2021 - 08h05/17h00
- Rendu appréciation du travail de stage.
- Démarrage du travail de diplôme et présentation moodle.
- Documentation
  - Intégration CDC
  - Introduction
  - Résumé
  - Planning prévisionnel
- Comparaison WPF et winforms
  - [Référence 1](https://www.c-sharpcorner.com/article/wpf-vs-winforms/#:~:text=The%20abbreviation%20W.P.F%20simply%20refers,to%20develop%20Windows%20desktop%20applications.)
    - Peu de différence autre que la structure
    - WPF semble plus récent et puissant
  - [Référence 2](https://www.wpf-tutorial.com/about-wpf/wpf-vs-winforms/)
    - Interface GUI plus performante (très intéressant)
    - Plus récent (Plus de librairies mise à jour)
  - [Référence 3](https://www.educba.com/winforms-vs-wpf/)
    - WPF est plus rapide
    - Aussi plus complexe
  - [Référence 4](https://stackoverflow.com/questions/31154338/windows-forms-vs-wpf)
    - Les deux se valent
    - WPF est meilleur pour les UI
    - WPF n'est pas disponible pour linux et mac
    - Le data binding est meilleur en WPF ainsi que le design
  - Conclusion
    - L'apprentissage de la structure WPF va prendre du temps mais semble en valoir la peine.
    - L'UI sera plus belle et simple à réaliser en WPF
    - Le plus gros avantage semble être BEAUCOUP plus efficace pour l'affichage de l'interface graphique me permettant d'utiliser le GPU à pleine puissance contrairement au winform qui ne l'utilise pas. S'achant que les pc sont équipé de gtx 1060, le changement en wpf semble être le meilleur choix.
    - WPF semble donc être le meilleur choix.
  - Une autre alternative à l'utilisation de l'interface graphique de WPF est unity qui peut être intégré et communiquer avec le projet. [Intégration d'unity en WPF](https://stackoverflow.com/questions/44059182/embed-unity3d-app-inside-wpf-application). [Communication](https://www.youtube.com/watch?v=rz6MNZMyza4). [Génération dynamique](https://www.youtube.com/watch?v=8eTWq27h4sY)
  - Unity semble être une bonne idée cependant, dans mon cas, en prenant en compte le nombre d'appelles, utiliser unity et faire communiquer les deux projets me semblent trop compliqué. Peut-être que rester sur WPF est plus sûr.
- Documentation
  - Analyse interface graphique
    - Comparaison WPF - WinForms - Unity
    - Choix de technologie
- Tentative de communication réussi à l'aide de ce [tutoriel](https://www.youtube.com/watch?v=rz6MNZMyza4).
  - inutilisable pour ce projet car la communication est trop restrainte.
  - La communication se fait uniquement avec des string ou des images mais pas d'objets c#.
- Tentative d'intégration d'unity dans un projet WPF
  - Réussi
  - Problème de resize
    - Au lancement prend toute la fenêtre
    - Le resize et positionnement fonctionnent
    - À la fermeture du programme, unity ne s'arrêtait pas et utilisait 15% du processeur à chaque ouverture.

# 20.04.2021 - 08h05/17h00
- Retrospective 19.04.2021
- Recherche des méthodes dans la dll user32.dll
- Recherche de différents moyens de communications entre WPF et Unity
  - Essai d'envoies de données de WPF à unity avec un pipeline anonyme
  - Essai d'envoies de données de WPF à unity avec un pipeline nommé
    - Réussi entre unity et WPF mais inutilisable actuellement
    - Il faut stoper le programme pour lire le message
    - Peut-être un problème lié au fait que les deux programme essaient de lire au même moment.

- Problèmes d'intelliSense sur unity
  - la connexion entre le script vs 2019 et unity n'est pas établies.
  - Mise à jour de vs 2019 et installation des paquets unity
  - Redémarrage du pc
  - Modifications de paramètre Unity et vs sans succès
  - Recherche de solutions concernant vs 2019 et non 2015
  - Pas suffisant. Ne fonctionne toujours pas
  - [Le point e. à reglé le prolème](https://blog.terresquall.com/2020/11/fixing-visual-studios-intellisense-autocomplete-in-unity/)
- Problème avec unity qui supprime mes objets à chaque fermeture du projet
  - La scène avait été suprimée et ne s'était pas rajoutée automatiquement
- Communication fonctionnel mais le projet unity freeze après chaque message.
  - Tentative d'utilisation de l'asynchrone pour palier au problème
    - Ce problèm est reglé cependant un problème de décalage fait que WPF parle chinois.
    - ![Communication entre WPF et unity qui résulte en chinoi](Medias/LogBook/Chinoi.png)
    - Essai de lecture de byte pour obtenir le résultat. sans succès
    - Refactoring du code pour fonctionner en async.
    - Le code est toujours imparfait et décalé
      - "Test communication" => "Test communication"
      - "Test communication" => "est communication"
      - "Test communication" => Signes chinois
  - Communication en string fonctionnelle à 100% en utilisant une méthode async récursive appelée au démarage du projet unity.
    - Méthode apellée chaque seconde ayant des résultats très aléatoire.
    - ![Code de base](Medias/LogBook/CodeReadPipeData1.png)
    - Méthode appellée une fois au démarrage puis à chaque fois qu'elle termine l'affichage de données reçues.
    - ![Nouvel exemple de code](Medias/LogBook/CodeReadPipeData2.png)
  - Idée pour l'implémentation en Unity : Envoyer des objets en JSON via le pipeline.
  - Test d'envoie d'un objet de WPF à Unity en JSON
    - ![Objets envoyés](Medias/LogBook/ObjectsSent.png)
    - ![Valeurs reçues](Medias/LogBook/ObjectReveived.png)

# 21.04.2021 - 08h05/17h00
- Documentation
  - Complétion de la comparaison de technologie d'interface graphique des pipelines.
  - Problèmes rencontrés - Pipelines
  - Intégration d'unity à WPF
- Modification de l'envoie de données pour utiliser un BinaryWriter à la place d'une Stream
  - Augmente la limite de données transmissible d'un Uin16 à int32.
- Modification de la réception des données pour utiliser un BinaryReader à la place d'un stream.
- Test d'intégration + communication réussi
- Début de la création de l'UI
  - Recherche d'un thème pour l'application
    - [Thème prometteur](https://github.com/MaterialDesignInXAML/MaterialDesignInXamlToolkit)
    - Test du thème
    - Le thème fonctionne et possède énormément de possibilités
  - Test de différents composants du thème
  - Boutons
  - TabControl
    - Changement d'icones
    - Changements de la couleur
    - Tentative de changer le background pour un background non pré-défini.
    - Intégration d'une autre page xaml depuis le TabControl
  - Création d'une page, pour la simulation, les paramètres graphiques et les paramètres de la simulation
  - Abandon du thpme trouvé du à son manque de responsivité malgré sa grande variété de contenu.

# 22.04.2021 - 08h05/17h00
- UI
  - Ajouts d'icône de boutons
  - Création de l'interface principal
    - Menu
    - Sections
    - Responsivité
  - Utilisation des columns et rows
  - Impossible de changer la couleur de la barre de titre du projet
    - Désaffichage de la barre
    - Création de ma propre barre
    - Différence entre les deux versions
      - ![Barre de titre windows](Medias/LogBook/BeforeTitleBar.png)
      - ![Barre de titre personnalisée](Medias/LogBook/AfterTitleBar.png)
  - Modification des méthodes de la barre de titre pour être utilisable sur toutes les pages
  - Modification de la structure des boutons pour intégrer directement l'image dans leur balise et non appeler une image. La version précédente empêchait plusieurs boutons d'avoir la même image. Résultat en l'affichage de premier bouton sans image.
  - Création de différentes pages de contenus
  - Navigation entre les pages
  - Modification de l'affichage d'un slider
    - Difficulté à trouver les bon paramètres
    - Binding de la couleur à la valeur du slider
    - Création d'un template pour le slider en récupérant la version de base de  [WPF](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/controls/slider-styles-and-templates?view=netframeworkdesktop-4.8)
    - Suppression de la track bar
    - Modification du RepeatButton
      - Création de deux version se situant à gauche et droit du thumb et ayant des couleurs différentes
    - Comparaison du slider de windows et du slider personnalisé à l'aide d'un template
      - ![slider comparaison](Medias/Logbook/Slider.png)
  - Modification de l'affichage des radioBoutons en récupérant la version de base de [WPF](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/controls/radiobutton-styles-and-templates?redirectedfrom=MSDN&view=netframeworkdesktop-4.8)
    - Nouveau design 
    - ![slider comparaison](Medias/Logbook/RadioButton.png)
  - Modification des couleurs pour qu'elle soient contenuent dans des balisent facilement modifiable.
  - Modification de l'affichage des checkbox en récupérant la version de base de [WPF](https://docs.microsoft.com/en-us/dotnet/desktop/wpf/controls/checkbox-styles-and-templates?view=netframeworkdesktop-4.8)
    - Nouveau design 
    - ![slider comparaison](Medias/Logbook/CheckBox.png)
- Modification de la fermeture des fenêtres pour cacher les fenêtres secondaires et fermer le programme en cas de fermeture de la fenêtre principale.

# 23.04.2021 - 08h05/16h10
- Documentation
  - Organisation
  - Maquettes
  - Introduction
    - Technologies utilisées
  - Schéma de fonctionnement
  - Description des technologies utilisées
- Réflexion sur le fonctionnement des threads pour l'application.
  - Parallel
- Installation LiveCharts
  - Installation packet LiveCharts
  - Installation packet LiveCharts.Wpf
  - Installation packet LiveCharts.Geared
- Graphiques
  - Bug à chaque changement de taille, régénérer la solution est nécessaire.
    - Uniquement dans le concepteur et non au lancement du programme
    - Nettoyer la solution permet de tout de même voir l'affichage de la fenêtre
  - Intégration de graphiques
    - Courbe
    - HeatMap
    - Colonne
    - Ligne
    - Bule
    - Circulaire (Camembert)
    - Area Stack
    - ![Graphiques integré à l'application WPF](Medias/LogBook/Graphiques.png)

# 26.04.2021 08h05 / 16h10
- Début de la création de la simulation
- Récupération du code du stage et suppression des éléments graphiques
- Commentaires
- Création d'une classe "Site" regroupant tous les lieux et véhicules
- Relecture du cahier des charges
- Relecture du fichier excel contenant la transmission par aérosol [2021_COVID-19_Aerosol_Transmissionn_Estimator](https://docs.google.com/spreadsheets/d/1x_QFiFPbqLtZTjuoVoCyPQdu7onu6c370NNlPZ3TfTk/edit#gid=1679887415)
- Création du code des lieux en fonction du fichier excel
  - Taille du batiment, longueur - largeur - hauter - air - volume
  - Paramètres de l'airs et de déposition
  - Utilisation du type double pour le calcul du taux d'infection
  - Suppression de certains paramètres non-utilisés
- Réflexion sur la structure du code et l'interaction entre les individus et les lieux
  - Résistance au virus
    - Maladies
    - Age
    - ![Evolution individus et accèssibilité des données](Medias/LogBook/MaladiesEtAge.png)
  - Création des planning
    - Pattern
    - (Gérer les cercles sociaux)
    - Création en fonction de l'âge
    - ![Création d'un planning](Medias/Logbook/CreationPlanning.png)
  - Mesures & Symptômes
    - resistance
    - comportement
    - Augmentent certains paramètres
    - ![Evolution individus et accèssibilité des données](Medias/LogBook/EvolutionIndividu.png)
  - Les activité ne contiennent que des types d'objets permettant de définir ce que l'individus fait. Le planning contient les lieux et les indiquent à l'individus.
- Création des plannings en fonction de la figure concernant leur création.
- Nombre d'école et autres batiments en fonction du nombre de personnes. Genève servant d'exemple.
  - ~0.03%  --> 165 écoles pour 500'000 personnes
  - ~6,74%  --> 33'700 entreprise pour 231'000 emplois
  - ~0.01%  --> 8 hopitaux, 2 cliniques, 30 lieux de soint
  - ~0,03%  --> ~136 supermarché
  - ~50%    --> ~250'000 appartements
- pareil mais pour l'âge de la population
  - ~22% 0-19  ans
  - ~63% 20-64 ans
  - ~10% 65-79 ans
  - ~5%  80+   ans
  - [Source](https://www.ge.ch/statistique/graphiques/affichage.asp?filtreGraph=11_02&dom=1)
- Pareil pour les transports
  - ~37%  --> à pied
  - ~36%  --> voiture (Chauffeur ou passagers)
  - ~15%  --> tpg
  - ~10%  --> vélos
  - [Source](https://www.letemps.ch/suisse/nombre-voitures-menage-diminue-geneve#:~:text=Au%20d%C3%A9but%20de%20l'ann%C3%A9e,augmentation%20de%206%2C5%25)
- Réflexion sur la création des transports et batiments et sur la source de certaines données.
  - On a une population de 100 personnes
    - 22% 0-19  ans
    - 63% 20-64 ans
    - 15% 65+ ans
  - Il faut donc au minimum 
    - Une école
    - Un supermarché
    - Une maison par personne (Pour le moment les < 19 ans vivent seuls)
  - On créé les batiments en fonction des besoins cité
  - Pour les véhicules
    - On créé 36 voitures
    - et des bus (a voir plus tard pour la quantitié)
  - Ensuite on créer les 100 individus
    - En fonction du pourcentage d'âge
    - On leur attribut 
      - Une maison vide
      - Une école
      - Un moyen de transport (vide si voiture)
    - On créer leur résistance